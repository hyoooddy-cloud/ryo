<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì•„ì´ëŒ ë ˆì¼ 5ë¸”ëŸ­: ë ˆì „ë“œ vs ì•„ì´ì½˜</title>
<style>
  :root{
    --bg:#0b0e17;
    --panel:#14182a;
    --card:#11162a;
    --line:#22284a;
    --legend:#7b61ff;
    --icon:#2fd3ff;
    --text:#ffffff;
    --muted:rgba(255,255,255,.72);

    --slotH:58px;
    --gap:10px;
    --shift: calc(var(--slotH) + var(--gap));
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",system-ui,sans-serif;
    display:flex; justify-content:center; align-items:center; min-height:100vh;
  }
  .app{ width:100%; max-width:520px; padding:18px; }

  .top{ display:flex; gap:10px; margin-bottom:12px; }
  .box{
    flex:1; background:var(--panel); padding:10px 14px;
    border-radius:14px; text-align:center;
  }
  .box span{ display:block; font-size:12px; opacity:.75; }
  .box b{ font-size:20px; display:inline-block; }

  /* ì½¤ë³´ ì—°ì¶œ */
  .comboPulse{ animation: comboPulse .22s ease-out; }
  @keyframes comboPulse{ 0%{transform:scale(1)} 55%{transform:scale(1.28)} 100%{transform:scale(1)} }
  .box.hot{ box-shadow: 0 0 0 2px rgba(255,255,255,.10) inset, 0 0 26px rgba(47,211,255,.22); }
  .box.hot b{ text-shadow: 0 0 12px rgba(47,211,255,.55); }

  .panel{
    background:rgba(17,22,42,.6);
    border:1px solid var(--line);
    border-radius:18px;
    padding:14px;
  }

  .titleRow{ display:flex; justify-content:space-between; align-items:baseline; gap:10px; }
  .title{ font-weight:900; font-size:16px; }
  .sub{ font-size:12px; color:var(--muted); }

  .railWrap{
    margin-top:12px;
    background:rgba(20,24,42,.55);
    border:1px solid var(--line);
    border-radius:18px;
    padding:12px;
    overflow:hidden;
    position:relative;
  }

  /* ì•„ë˜ë¡œ ê°ˆìˆ˜ë¡ ì‚¬ë¼ì§€ëŠ” ê·¸ë¼ë°ì´ì…˜ ë§ˆìŠ¤í¬(ì§€ë‚˜ê°„ ë¬¸ì œ ëŠë‚Œ) */
  .railWrap::after{
    content:"";
    position:absolute;
    left:0; right:0; bottom:0;
    height:42%;
    pointer-events:none;
    background: linear-gradient(to bottom,
      rgba(11,14,23,0) 0%,
      rgba(11,14,23,.25) 35%,
      rgba(11,14,23,.55) 70%,
      rgba(11,14,23,.9) 100%
    );
  }

  .slots{
    position:relative;
    display:flex;
    flex-direction:column;
    gap:var(--gap);
    will-change: transform;
  }

  .block{
    height:var(--slotH);
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    background:var(--card);
    border:1px solid var(--line);
    border-radius:14px;
    padding:0 10px;
    font-weight:900;
    font-size:15px;
    line-height:1.15;
    user-select:none;
    will-change: transform;
  }

  /* í˜„ì¬ ë¬¸ì œ(3ë²ˆì§¸ ì¹¸) ê°•ì¡° */
  .block.selected{
    font-size:17px;
    transform: scale(1.06);
    border-color: rgba(255,255,255,.45);
    box-shadow: 0 0 0 2px rgba(255,255,255,.18) inset, 0 10px 26px rgba(0,0,0,.45);
    position:relative;
  }
  .block.selected::after{
    content:"ì§€ê¸ˆ ë§ì¶”ëŠ” ë¸”ëŸ­";
    position:absolute;
    right:10px;
    top:8px;
    font-size:11px;
    font-weight:800;
    opacity:.8;
  }

  /* ì§€ë‚˜ê°„ ë¸”ëŸ­(ì„ íƒì¹¸ ì•„ë˜) */
  .block.past{
    opacity:.42;
    filter:saturate(.75);
    position:relative;
    background: rgba(17,22,42,.78);
  }
  .block.past::after{
    content:"PASSED";
    position:absolute;
    left:10px;
    bottom:6px;
    font-size:10px;
    font-weight:800;
    letter-spacing:.08em;
    opacity:.60;
  }

  /* ìƒˆë¡œ ë“¤ì–´ì˜¨ ë¸”ëŸ­(ë§¨ ìœ„) */
  .block.enter{
    opacity:0;
    transform: translateY(-10px);
  }
  .block.enter.enterOn{
    opacity:1;
    transform: translateY(0);
  }

  .hint{ margin-top:10px; text-align:center; font-size:13px; color:var(--muted); min-height:18px; }

  /* ì•¡ì…˜ ì˜ì—­: START ìë¦¬ â†’ ê²Œì„ ì‹œì‘ í›„ ë ˆì „ë“œ/ì•„ì´ì½˜ */
  .actions{ margin-top:12px; }

  .buttons{ display:flex; gap:10px; }
  .btnCol{ flex:1; display:flex; flex-direction:column; gap:6px; }
  .btnNote{ text-align:center; font-size:11px; opacity:.75; }

  button{
    width:100%;
    padding:12px;
    border-radius:16px;
    border:none;
    font-weight:900;
    cursor:pointer;
  }
  .btnLegend{ background:var(--legend); color:#fff; }
  .btnIcon{ background:var(--icon); color:#001018; }
  .start{ background:#22284a; color:#fff; border:1px solid #2a3158; }
  button:disabled{ opacity:.55; cursor:not-allowed; }

  .startRow{ display:flex; gap:10px; margin-top:12px; }
  .copy{ flex:1; background:#1a203d; color:#fff; border:1px solid #2a3158; }

  .result{
    margin-top:12px;
    background:#0f1426;
    border:1px solid var(--line);
    border-radius:16px;
    padding:12px;
    display:none;
  }
  .result h3{ margin:0 0 6px; font-size:15px; }
  .rtype{ font-weight:900; font-size:18px; margin:4px 0; }
  .rdesc{ font-size:13px; opacity:.88; line-height:1.45; }
  .rmeta{ font-size:12px; opacity:.8; margin-top:8px; line-height:1.5; }
  .shareBox{
    margin-top:10px;
    background:#10193a;
    border:1px solid #22306a;
    border-radius:12px;
    padding:10px;
    font-size:12px;
    white-space:pre-wrap;
  }

  .kbd{ margin-top:10px; text-align:center; font-size:12px; opacity:.65; }
</style>
</head>
<body>

<div class="app">
  <div class="top">
    <div class="box"><span>SCORE</span><b id="score">0</b></div>
    <div class="box" id="comboBox"><span>COMBO</span><b id="combo">0</b></div>
    <div class="box"><span>TIME</span><b id="time">60</b></div>
  </div>

  <div class="panel">
    <div class="titleRow">
      <div class="title">ì•„ì´ëŒ ë ˆì¼ 5ë¸”ëŸ­</div>
      <div class="sub">3ë²ˆì§¸ ë¸”ëŸ­ì´ ë ˆì „ë“œ(7ë…„â†‘)ì¸ì§€ ì•„ì´ì½˜(7ë…„â†“)ì¸ì§€ ë§íˆê¸°</div>
    </div>

    <div class="railWrap">
      <div class="sub" style="margin-bottom:8px;">ë” ì»¤ì§„ ê·œëª¨, ê¸¸ì–´ì§„ ì—­ì‚¬!<br/>ìƒˆë¡œì›Œì§„ ìµœì• ëŒ ë¦¬ê·¸ í•œë²ˆì— íŒŒì•…í•˜ê¸°!</div>
      <div class="slots" id="slots"></div>
    </div>

    <div class="hint" id="hint"></div>

    <div class="actions">
      <!-- ê²Œì„ ì‹œì‘ ì „: STARTë§Œ -->
      <div id="startOnly">
        <button class="start" id="btnStart">START</button>
      </div>

      <!-- ê²Œì„ ì‹œì‘ í›„: ë ˆì „ë“œ/ì•„ì´ì½˜ë§Œ -->
      <div class="buttons" id="answerButtons" style="display:none;">
        <div class="btnCol">
          <button class="btnLegend" id="btnLegend">ğŸ† ë ˆì „ë“œ</button>
          <div class="btnNote">ë°ë·” 7ë…„ ì´ìƒ</div>
        </div>
        <div class="btnCol">
          <button class="btnIcon" id="btnIcon">â­ ì•„ì´ì½˜</button>
          <div class="btnNote">ë°ë·” 7ë…„ ì´í•˜</div>
        </div>
      </div>

      <div class="startRow">
        <button class="copy" id="btnCopy" disabled>ê³µìœ ë¬¸êµ¬ ë³µì‚¬</button>
      </div>
    </div>

    <div class="result" id="result">
      <h3>ê²°ê³¼</h3>
      <div class="rtype" id="rtype">-</div>
      <div class="rdesc" id="rdesc">-</div>
      <div class="rmeta" id="rmeta">-</div>
      <div class="shareBox" id="shareText"></div>
    </div>

    <div class="kbd">PC: â† = ë ˆì „ë“œ / â†’ = ì•„ì´ì½˜</div>
  </div>
</div>

<script>
const CURRENT_YEAR = 2026;
const GAME_TIME = 60;
const VISIBLE_COUNT = 5;
const ACTIVE_INDEX = 2; // 0ë¶€í„° ì‹œì‘(3ë²ˆì§¸ ì¹¸)

// ë°ì´í„°(ì›í•˜ë©´ ì—¬ê¸°ë§Œ ê³„ì† ì¶”ê°€í•˜ë©´ ë¨)
const IDOLS = [
  // ë ˆì „ë“œ ìª½(ì˜ˆì‹œ)
  {name:"BTS", debut:2013},{name:"Red Velvet", debut:2014},{name:"TWICE", debut:2015},{name:"SEVENTEEN", debut:2015},
  {name:"MAMAMOO", debut:2014},{name:"BLACKPINK", debut:2016},{name:"NCT", debut:2016},{name:"DAY6", debut:2015},
  {name:"OH MY GIRL", debut:2015},{name:"ASTRO", debut:2016},{name:"WJSN", debut:2016},{name:"iKON", debut:2015},
  {name:"PENTAGON", debut:2016},{name:"THE BOYZ", debut:2017},

  // ì•„ì´ì½˜ ìª½(ì˜ˆì‹œ)
  {name:"ITZY", debut:2019},{name:"TXT", debut:2019},{name:"aespa", debut:2020},{name:"ENHYPEN", debut:2020},
  {name:"TREASURE", debut:2020},{name:"IVE", debut:2021},{name:"LE SSERAFIM", debut:2022},{name:"NewJeans", debut:2022},
  {name:"NMIXX", debut:2022},{name:"ZEROBASEONE", debut:2023},{name:"RIIZE", debut:2023},{name:"BOYNEXTDOOR", debut:2023},
  {name:"BABYMONSTER", debut:2024},{name:"ILLIT", debut:2024},{name:"TWS", debut:2024},{name:"KISS OF LIFE", debut:2023},
  {name:"EVNNE", debut:2023},{name:"UNIS", debut:2024},{name:"RESCENE", debut:2024}
];

// UI
const $score = document.getElementById('score');
const $combo = document.getElementById('combo');
const $time  = document.getElementById('time');
const $hint  = document.getElementById('hint');
const $slots = document.getElementById('slots');
const $comboBox = document.getElementById('comboBox');

const $btnLegend = document.getElementById('btnLegend');
const $btnIcon   = document.getElementById('btnIcon');
const $btnStart  = document.getElementById('btnStart');
const $btnCopy   = document.getElementById('btnCopy');

const $startOnly = document.getElementById('startOnly');
const $answerButtons = document.getElementById('answerButtons');

const $result = document.getElementById('result');
const $rtype = document.getElementById('rtype');
const $rdesc = document.getElementById('rdesc');
const $rmeta = document.getElementById('rmeta');
const $shareText = document.getElementById('shareText');

// State
let deck = [];
let queue = [];         // í™”ë©´ì— ë³´ì´ëŠ” 5ê°œ(ìœ„->ì•„ë˜)
let blockEls = [];      // ê³ ì • 5ê°œ DOM(FLIP)
let score = 0;
let combo = 0;
let timeLeft = GAME_TIME;
let timer = null;
let playing = false;
let locked = false;

// stats
let total = 0;
let correctCount = 0;
let wrongCount = 0;
let bestCombo = 0;

function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}
function draw(){
  if(deck.length === 0) deck = shuffle(IDOLS);
  return deck.pop();
}
function isLegend(idol){ return (CURRENT_YEAR - idol.debut) >= 7; }

function updateUI(){
  $score.textContent = score;
  $combo.textContent = combo;
  $time.textContent  = timeLeft;
}

function comboFx(){
  $combo.classList.remove('comboPulse');
  void $combo.offsetWidth;
  $combo.classList.add('comboPulse');
  if(combo >= 5) $comboBox.classList.add('hot');
  else $comboBox.classList.remove('hot');
}

function ensureBlocks(){
  if(blockEls.length === VISIBLE_COUNT) return;
  $slots.innerHTML = '';
  blockEls = [];
  for(let i=0; i<VISIBLE_COUNT; i++){
    const el = document.createElement('div');
    el.className = 'block';
    $slots.appendChild(el);
    blockEls.push(el);
  }
}
function applyClasses(){
  for(let i=0; i<VISIBLE_COUNT; i++){
    const el = blockEls[i];
    el.classList.toggle('selected', i === ACTIVE_INDEX);
    el.classList.toggle('past', i > ACTIVE_INDEX);
  }
}

function renderQueue({enterTop=false, flip=false} = {}){
  ensureBlocks();

  const before = flip ? blockEls.map(el => el.getBoundingClientRect()) : null;

  for(let i=0; i<VISIBLE_COUNT; i++){
    blockEls[i].textContent = queue[i]?.name ?? '';
  }
  applyClasses();

  // ìƒˆë¡œ ë“¤ì–´ì˜¨ ë§¨ ìœ„ ë¸”ëŸ­(0ë²ˆ) ë“±ì¥
  if(enterTop){
    const topEl = blockEls[0];
    topEl.classList.add('enter');
    requestAnimationFrame(() => topEl.classList.add('enterOn'));
    setTimeout(() => {
      topEl.classList.remove('enter');
      topEl.classList.remove('enterOn');
    }, 240);
  }

  if(!flip) return;

  const after = blockEls.map(el => el.getBoundingClientRect());
  for(let i=0; i<VISIBLE_COUNT; i++){
    const dx = before[i].left - after[i].left;
    const dy = before[i].top - after[i].top;
    if(dx === 0 && dy === 0) continue;

    const el = blockEls[i];
    const isSel = el.classList.contains('selected');
    const base = isSel ? ' scale(1.06)' : '';
    el.animate(
      [
        { transform: `translate(${dx}px, ${dy}px)${base}` },
        { transform: base.trim() || 'translate(0,0)' }
      ],
      { duration: 220, easing: 'cubic-bezier(.2,.8,.2,1)' }
    );
  }
}

function calcResultType(acc, bestCombo){
  if (acc >= 90 && bestCombo >= 10) return { title:"ğŸ“š ì•„ì´ëŒ ì—°ëŒ€ê¸° ë§ˆìŠ¤í„°", desc:"ì—°ì°¨ ê°ê°ì´ êµê³¼ì„œê¸‰. ë°ë·” ì—°ë„ ì§€ë¬¸ë§Œ ë´ë„ ë§íˆëŠ” íƒ€ì…!" };
  if (acc >= 85) return { title:"ğŸ§  ì„¸ëŒ€ ì •ë¦¬ì™•", desc:"ë ˆì „ë“œ/ì•„ì´ì½˜ ê²½ê³„ë¥¼ ì •í™•íˆ ìºì¹˜í•´. ë•ì§ˆ ì´ë ¥ì„œê°€ ë¹›ë‚œë‹¤." };
  if (acc >= 70 && bestCombo >= 8) return { title:"âš¡ ë°˜ì‚¬ì‹ ê²½ ë•í›„", desc:"ë¹ ë¥´ê²Œ ì°ê³  ë¹ ë¥´ê²Œ ë§íŒë‹¤! ê°ê°ìœ¼ë¡œ ê²Œì„ì„ ëš«ëŠ” íƒ€ì…." };
  if (acc >= 65) return { title:"ğŸ§ ì²´ê°ì—°ì°¨ í”Œë ˆì´ì–´", desc:"ì •í™•í•˜ì§„ ì•Šì•„ë„ â€˜ëŠë‚Œâ€™ì´ ìˆë‹¤. ìµœì‹  ë¼ì¸ì—…ì— ê°•í•œ í¸!" };
  if (acc >= 50) return { title:"ğŸŒ€ í˜¼ì¢… ì„¸ëŒ€ íƒí—˜ê°€", desc:"ì„¸ëŒ€ ê²½ê³„ì—ì„œ í”ë“¤ë¦¬ëŠ” ì¤‘â€¦ í•˜ì§€ë§Œ ë°œì „ ê°€ëŠ¥ì„± 100%." };
  return { title:"ğŸ£ ë‰´ë¹„ í”„ë¡œë“€ì„œ", desc:"ì§€ê¸ˆë¶€í„°ê°€ ì‹œì‘! í•œ íŒ ë” í•˜ë©´ ì²´ê° ì—°ì°¨ê°€ í™• ì˜¬ë¼ê°ˆê±¸?" };
}

function showStartOnly(){
  $startOnly.style.display = 'block';
  $answerButtons.style.display = 'none';
}
function showAnswerButtons(){
  $startOnly.style.display = 'none';
  $answerButtons.style.display = 'flex';
}

function endGame(){
  playing = false;
  locked = false;
  clearInterval(timer);
  timer = null;

  showStartOnly();
  $btnStart.textContent = 'RESTART';

  $hint.textContent = 'ê²Œì„ ì¢…ë£Œ! ê²°ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš” ğŸ‘‡';

  const acc = total ? Math.round((correctCount/total)*100) : 0;
  const t = calcResultType(acc, bestCombo);

  const share = [
    'ì•„ì´ëŒ ë ˆì¼ 5ë¸”ëŸ­ ê²°ê³¼',
    `íƒ€ì…: ${t.title}`,
    `ì ìˆ˜: ${score}ì  / ì •í™•ë„: ${acc}%`,
    `ì •ë‹µ ${correctCount} Â· ì˜¤ë‹µ ${wrongCount} Â· ìµœê³ ì½¤ë³´ ${bestCombo}`,
    '',
    'ë„ˆë„ í•´ë´ ğŸ‘‰ (ì—¬ê¸°ì— ë§í¬ ë„£ê¸°)'
  ].join('\n');

  $rtype.textContent = t.title;
  $rdesc.textContent = t.desc;
  $rmeta.textContent = `ì •í™•ë„ ${acc}% Â· ì •ë‹µ ${correctCount}/${total} Â· ìµœê³ ì½¤ë³´ ${bestCombo} Â· ì ìˆ˜ ${score}ì `;
  $shareText.textContent = share;

  $result.style.display = 'block';
  $btnCopy.disabled = false;
}

function answer(choiceLegend){
  if(!playing || locked) return;

  locked = true;

  const idol = queue[ACTIVE_INDEX];
  total += 1;

  const correct = (choiceLegend === isLegend(idol));

  if(correct){
    correctCount += 1;
    combo += 1;
    bestCombo = Math.max(bestCombo, combo);
    const add = 10 + (combo >= 5 ? 10 : 0);
    score += add;

    comboFx();
    $hint.textContent = `ì •ë‹µ! +${add} (${idol.name}, ${idol.debut})`;
    if(combo === 5) $hint.textContent = `ğŸ”¥ 5 COMBO! +${add} (${idol.name}, ${idol.debut})`;
    if(combo === 10) $hint.textContent = `âš¡ 10 COMBO! +${add} (${idol.name}, ${idol.debut})`;
  } else {
    wrongCount += 1;
    combo = 0;
    comboFx();
    score = Math.max(0, score - 5);
    $hint.textContent = `ì˜¤ë‹µ! -5 (${idol.name}, ${idol.debut})`;
  }

  updateUI();

  // ì»¨ë² ì´ì–´ì²˜ëŸ¼: í•œ ì¹¸ ì•„ë˜ë¡œ ìŠ¤ë¥´ë¥µ
  $slots.style.transition = 'transform .22s ease-in-out';
  $slots.style.transform = `translateY(${getComputedStyle(document.documentElement).getPropertyValue('--shift').trim() || '68px'})`;

  setTimeout(() => {
    // ìˆœê°„ ë¦¬ì…‹
    $slots.style.transition = 'none';
    $slots.style.transform = 'translateY(0)';

    // íšŒì „: ë§¨ ì•„ë˜ ì œê±° + ë§¨ ìœ„ ì¶”ê°€
    queue.pop();
    queue.unshift(draw());

    renderQueue({enterTop:true, flip:true});
    locked = false;
  }, 230);
}

function startGame(){
  // reset
  score = 0; combo = 0; timeLeft = GAME_TIME;
  total = 0; correctCount = 0; wrongCount = 0; bestCombo = 0;
  deck = shuffle(IDOLS);
  queue = [];
  playing = true;
  locked = false;

  showAnswerButtons();

  $result.style.display = 'none';
  $btnCopy.disabled = true;

  // ì‹œì‘ ì‹œ 5ê°œ ì±„ìš°ê¸°
  for(let i=0; i<VISIBLE_COUNT; i++) queue.push(draw());
  renderQueue();

  $hint.textContent = '3ë²ˆì§¸(ì„ íƒë¨) ë¸”ëŸ­ì´ ë ˆì „ë“œ/ì•„ì´ì½˜ì¸ì§€ ë§í˜€ë³´ì„¸ìš”!';
  updateUI();
  comboFx();

  clearInterval(timer);
  timer = setInterval(() => {
    timeLeft -= 1;
    $time.textContent = timeLeft;
    if(timeLeft <= 0) endGame();
  }, 1000);
}

// ì´ë²¤íŠ¸
$btnLegend.addEventListener('click', () => answer(true));
$btnIcon.addEventListener('click', () => answer(false));
$btnStart.addEventListener('click', startGame);

$btnCopy.addEventListener('click', async () => {
  const text = $shareText.textContent;
  try{
    await navigator.clipboard.writeText(text);
    $hint.textContent = 'ê³µìœ  ë¬¸êµ¬ ë³µì‚¬ ì™„ë£Œ! âœ…';
  }catch(e){
    $hint.textContent = 'ë³µì‚¬ ì‹¤íŒ¨ ğŸ˜­ ê³µìœ ë¬¸êµ¬ë¥¼ ë“œë˜ê·¸í•´ì„œ ë³µì‚¬í•´ì¤˜.';
  }
});

window.addEventListener('keydown', (e) => {
  if(!playing) return;
  if(e.key === 'ArrowLeft') answer(true);
  if(e.key === 'ArrowRight') answer(false);
});

// ì´ˆê¸° UI
showStartOnly();
updateUI();
</script>
</body>
</html>
